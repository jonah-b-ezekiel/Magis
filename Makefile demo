################################################################################
# Makefile for prepareCamera.cpp
################################################################################
PROJECT_ROOT=./

################################################################################
# Key paths and settings
################################################################################
CFLAGS += -std=c++11 -g
ifeq ($(wildcard ${OPT_INC}),)
CXX = g++ ${CFLAGS}
ODIR  = .obj/build
SDIRP  = ./prepareCamera
SDIRA = ./acquireImages
MKDIR = mkdir -p
PLATFORM = $(shell uname)
ifeq ($(PLATFORM),Darwin)
OS = mac
endif
endif

OUTPUTNAMEP = prepareCamera
OUTPUTNAMEA = acquireImages
OUTDIR = .

################################################################################
# Dependencies
################################################################################
# Library dependencies
SPINNAKER_LIB = -L/opt/spinnaker/lib -lSpinnaker
LGPIO_LIB = -lpigpio

################################################################################
# Master inc/lib/obj/dep settings
################################################################################
_OBJP = prepareCamera.o
_OBJA = acquireImages.o
# turn object file names into ones that are in the currct directory
OBJP = $(patsubst %,$(ODIR)/%,$(_OBJP))
OBJA = $(patsubst %, $(ODIR)/%, $(_OBJA))
INC = -I./include
INC += -I/usr/include/spinnaker
INC += -I/usr/src/json/single_include/nlohmann
LIB += -Wl,-Bdynamic ${LGPIO_LIB} ${SPINNAKER_LIB}
 
################################################################################
# Rules/recipes
################################################################################
# Final binary
# Final binary
.PHONY: ${OUTPUTNAMEP} ${OUTPUTNAMEA}
${OUTPUTNAMEP}: ${OBJP}
	${CXX} -o ${OUTPUTNAMEP} ${OBJP} ${LIB}
$(OUTPUTNAMEA}: ${OBJA}
  ${CXX} -o ${OUTPUTNAMEA} ${OBJA} ${LIB}
#some phony target with both executables
#somehow need two {OBJ, SDIR, etc.}
# want ODIR to be demo, which is current directory
#all other steps should be the same
# Intermediate object files
# pattern rule - prerequisites are cpp files located in source directory with same name as object files located in object directory
${OBJA}: ${ODIR}/%.o : ${SDIRA}/%.cpp
	@${MKDIR} ${ODIR}
# compile first prerequisite: don't link, object file has name of target (ODIR/prepareCamera.o)
	${CXX} ${CFLAGS} ${INC} -Wall -D LINUX -c $< -o $@
${OBJP}: ${ODIR}/%.o : ${SIDRP}/%.cpp
  ${CXX} ${CFLAGS} ${INC} -Wall -D LINUX -c $< -o $@
# Clean up intermediate objects
clean_obj:
	rm -f ${OBJ*}
	@echo "intermediate objects cleaned up!"

# Clean up everything.
clean: clean_obj
	rm -f ${OUTDIR}/${OUTPUTNAME*}
	@echo "all cleaned up!"
